from data import registered_users

PROMPT_TEMPLATES = {
    "writing": (
        "Ты выступаешь в роли эксперта по IELTS в разделе Writing.\n"
        "Задание: {current_task}\n"
        "Тип задания: {task_type}\n"
        "Ответ пользователя:\n"
        "{user_answer}\n\n"
        "Оцени ответ по следующим критериям:\n"
        "1. Соответствие заданию: насколько ответ полностью и точно раскрывает тему и соответствует требованиям задания.\n"
        "2. Структура и организация: наличие чёткого введения, основной части и заключения, логичное и последовательное изложение мыслей.\n"
        "3. Грамматическая точность: выявление грамматических ошибок, некорректных конструкций, рекомендации по исправлению ошибок.\n"
        "4. Лексический запас: разнообразие и уместность используемой лексики, точность терминологии, избегание повторов.\n"
        "5. Когерентность: плавность переходов между абзацами и логическая связь между идеями.\n"
        "6. Аргументация и примеры: обоснованность идей, наличие убедительных аргументов и примеров.\n\n"
        "Проведи детальный разбор, укажи сильные стороны ответа, выяви ошибки и предложи конкретные рекомендации по улучшению.\n"
    ),
    "speaking": (
        "Ты выступаешь в роли эксперта по IELTS в разделе Speaking.\n"
        "Задание: {current_task}\n"
        "Тип задания: {task_type}\n"
        "Ответ пользователя:\n"
        "{user_answer}\n\n"
        "Оцени ответ по следующим критериям:\n"
        "1. Флуентность и связность: насколько свободно и логично излагается речь, отсутствие длительных пауз.\n"
        "2. Произношение и интонация: качество произношения, корректность акцента и интонационных моделей.\n"
        "3. Грамматическая точность: правильность и разнообразие используемых грамматических конструкций.\n"
        "4. Лексический запас: богатство и уместность словарного запаса, использование идиоматических выражений.\n"
        "5. Соответствие заданию: полнота раскрытия темы и способность отвечать на поставленные вопросы.\n"
        "6. Выразительность и уверенность: общее впечатление от речи, умение ясно и убедительно донести мысли.\n\n"
        "Проведи детальный разбор, выдели положительные моменты и укажи области для улучшения, приведи примеры корректного использования языка.\n"
    ),
    "reading": (
        "Ты выступаешь в роли эксперта по IELTS в разделе Reading.\n"
        "Задание: {current_task}\n"
        "Тип задания: {task_type}\n"
        "Ответ пользователя:\n"
        "{user_answer}\n\n"
        "Учитывая, что вопросы в разделе Reading обычно представлены в виде тестов (выбор одного из вариантов ответа) или заданий на заполнение пропусков, оцени ответ по следующим критериям:\n"
        "1. Точность выбора: насколько правильно выбран вариант ответа или заполнен пропуск в соответствии с оригинальным текстом.\n"
        "2. Понимание текста: насколько точно и полно выявлены основные идеи и детали исходного материала.\n"
        "3. Анализ информации: способность распознать ключевые моменты и детали, влияющие на правильность ответа.\n"
        "4. Соответствие заданию: правильное выполнение поставленной задачи в тестовом формате.\n"
        "5. Ясность и логика: последовательность мыслей при выборе ответа и обоснование своего выбора (если это требуется).\n\n"
        "Проведи детальный разбор, укажи, что выполнено правильно, а что требует доработки, и предложи рекомендации по улучшению.\n"
    ),
    "listening": (
        "Ты выступаешь в роли эксперта по IELTS в разделе Listening.\n"
        "Задание: {current_task}\n"
        "Тип задания: {task_type}\n"
        "Ответ пользователя:\n"
        "{user_answer}\n\n"
        "Учитывая, что вопросы в разделе Listening обычно представлены в виде тестов (выбор одного из вариантов ответа) или заданий на заполнение пропусков, оцени ответ по следующим критериям:\n"
        "1. Точность выбора: насколько правильно выбран вариант ответа или заполнен пропуск в соответствии с прослушанным аудио.\n"
        "2. Понимание аудио: насколько точно и полно выявлены основные идеи и ключевые детали прослушанного материала.\n"
        "3. Выявление нюансов: способность заметить важные детали, влияющие на понимание задания.\n"
        "4. Соответствие заданию: правильное выполнение тестового задания на основе прослушанного материала.\n"
        "5. Обоснование выбора (если применимо): логичное объяснение выбранного ответа, если это требуется.\n\n"
        "Проведи детальный разбор, укажи сильные стороны ответа, выяви ошибки и дай конкретные рекомендации для улучшения.\n"
    )
}


def get_prompt_feedback(task_type, user_answer, user_id):
    current_task = registered_users[user_id]['current_task']
    template = PROMPT_TEMPLATES.get(task_type)
    if template:
        return template.format(
            current_task=current_task,
            user_answer=user_answer,
            task_type=task_type.capitalize()
        )
    else:
        return "Неизвестный тип задания."
